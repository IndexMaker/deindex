<mxfile host="Electron" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.7.8 Chrome/128.0.6613.36 Electron/32.0.1 Safari/537.36" version="24.7.8">
  <diagram name="Page-1" id="pUh8WFY2SnKyCuJ9CHHV">
    <mxGraphModel dx="2575" dy="1728" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="rVFemPRaLwJsk6ttoFU8-1" value="Solver&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;Strategy&lt;/span&gt;&lt;div&gt;(contract)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="720" y="110" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-2" value="Collateral Router&lt;div&gt;(contract)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="280" y="-180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-10" value="&lt;div&gt;&lt;ol&gt;&lt;li&gt;submit orders&lt;/li&gt;&lt;li&gt;submit baskets&lt;/li&gt;&lt;li&gt;get filled orders&lt;/li&gt;&lt;li&gt;get carried orders&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;labelBackgroundColor=none;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-3" target="rVFemPRaLwJsk6ttoFU8-1">
          <mxGeometry x="-1" y="30" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-14" value="mint ITP" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-3" target="rVFemPRaLwJsk6ttoFU8-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-15" value="get baskets" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-3" target="rVFemPRaLwJsk6ttoFU8-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-16" value="get next hop" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-11" target="rVFemPRaLwJsk6ttoFU8-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-3" value="Index Order Manager&lt;div&gt;(contract)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;glass=0;" vertex="1" parent="1">
          <mxGeometry x="420" y="110" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-4" value="Basket Manager&lt;div&gt;(contract)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="330" y="-75" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-5" value="ITP Minting&lt;div&gt;(contract)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-12" value="&lt;ol&gt;&lt;li&gt;&quot;poke&quot;&lt;/li&gt;&lt;li&gt;get collateral routing request&lt;/li&gt;&lt;li&gt;get next order batch&lt;/li&gt;&lt;/ol&gt;" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;labelBackgroundColor=none;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-11" target="rVFemPRaLwJsk6ttoFU8-3">
          <mxGeometry x="0.3433" y="-20" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-13" value="&lt;div&gt;&lt;ol&gt;&lt;li&gt;submit market data&lt;/li&gt;&lt;li&gt;compute orders&lt;/li&gt;&lt;li&gt;get asset orders&lt;/li&gt;&lt;li&gt;compute fills&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;labelBackgroundColor=none;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-11" target="rVFemPRaLwJsk6ttoFU8-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-20" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;shape=flexArrow;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-11" target="rVFemPRaLwJsk6ttoFU8-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-22" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;shape=flexArrow;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-11" target="rVFemPRaLwJsk6ttoFU8-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-24" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;shape=flexArrow;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-11" target="rVFemPRaLwJsk6ttoFU8-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-11" value="Authorised&lt;div&gt;Provider&lt;/div&gt;&lt;div&gt;(service)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;glass=0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="530" y="-220" width="190" height="110" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-17" value="Binance" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="-560" width="190" height="120" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-18" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;shape=flexArrow;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-11" target="rVFemPRaLwJsk6ttoFU8-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-19" value="Base" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="640" y="-600" width="170" height="110" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-21" value="Bitget" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="890" y="-440" width="180" height="110" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-23" value="Arbitrum" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="-560" width="170" height="110" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-30" value="&lt;ol&gt;&lt;li&gt;Browse&lt;/li&gt;&lt;li&gt;Sign Permit20&lt;/li&gt;&lt;li&gt;Send Order&lt;/li&gt;&lt;/ol&gt;" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;labelBackgroundColor=none;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-28" target="rVFemPRaLwJsk6ttoFU8-29">
          <mxGeometry x="-0.7778" y="30" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-28" value="User" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="1">
          <mxGeometry x="-120" y="240" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-31" value="submit order&lt;div&gt;containing permit20&lt;/div&gt;" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;labelBackgroundColor=none;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-29" target="rVFemPRaLwJsk6ttoFU8-3">
          <mxGeometry x="-0.7799" y="21" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-29" value="Web3 App" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="70" y="240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-35" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-33" target="rVFemPRaLwJsk6ttoFU8-29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-33" value="&lt;b&gt;Step 1. Order Submission (part.1)&lt;br&gt;&lt;/b&gt;&lt;ol&gt;&lt;li&gt;User browses the app, and then&lt;/li&gt;&lt;li&gt;Clicks to buy index&lt;/li&gt;&lt;li&gt;Wallet prompts asking to sign permit20&lt;/li&gt;&lt;li&gt;App sends order that contains the permit20 in it to Index Order Manager contract.&lt;/li&gt;&lt;/ol&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;spacing=0;size=14;align=left;spacingRight=20;spacingLeft=10;spacingTop=10;" vertex="1" parent="1">
          <mxGeometry x="-150" y="400" width="250" height="155" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-38" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-37" target="rVFemPRaLwJsk6ttoFU8-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-37" value="&lt;b&gt;Step 2. Order Submission (part.2)&lt;br&gt;&lt;/b&gt;&lt;ol&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Index Order Manager contract&amp;nbsp;&lt;/span&gt;adds new order to a queue&lt;/li&gt;&lt;li&gt;Picks next orders from queue and fills bucket for next batch&lt;/li&gt;&lt;li&gt;Gets baskets for index orders that it places into bucket from Basket Manager&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;b&gt;Note&lt;/b&gt; for fresh orders they would be in Route-Collateral state.&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;spacing=0;size=14;align=left;spacingRight=20;spacingLeft=10;spacingTop=10;" vertex="1" parent="1">
          <mxGeometry x="210" y="360" width="250" height="220" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-41" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-40" target="rVFemPRaLwJsk6ttoFU8-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-40" value="&lt;b&gt;Step 4. Batch Processing (part.1)&lt;br&gt;&lt;/b&gt;&lt;ol&gt;&lt;li&gt;Authorised Provider &quot;pokes&quot; Index Order Manager&lt;/li&gt;&lt;li&gt;Authorised Provider submits market data for the batch to Solver Strategy and calls compute&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;b&gt;Step 4. Batch Processing (part.3)&lt;br&gt;&lt;/b&gt;&lt;ol&gt;&lt;/ol&gt;&lt;/div&gt;&lt;ol&gt;&lt;li&gt;Authorised Provider gets asset orders from Solver Strategy&lt;/li&gt;&lt;li&gt;Authorised Provider sends order to CEX e.g. Binance&lt;/li&gt;&lt;li&gt;Authorised Provider receives fills from CEX e.g. Binance&lt;/li&gt;&lt;li&gt;Authorised Provider submits fills to Solver Strategy&lt;/li&gt;&lt;/ol&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;spacing=0;size=14;align=left;spacingRight=20;spacingLeft=10;spacingTop=10;" vertex="1" parent="1">
          <mxGeometry x="880" y="-160" width="261" height="280" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-43" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-42" target="rVFemPRaLwJsk6ttoFU8-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-42" value="&lt;b&gt;Step 4. Batch Processing (part.2)&lt;/b&gt;&lt;ol&gt;&lt;li&gt;Index Order Manager checks and updates its queues and current batch bucket&lt;/li&gt;&lt;li&gt;Index Order Manager get from Basket Manager baskets for any new orders to be placed into current batch.&lt;/li&gt;&lt;li&gt;Index Order Manager submits order batch and baskets to Solver Strategy&lt;/li&gt;&lt;/ol&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;spacing=0;size=14;align=left;spacingRight=20;spacingLeft=10;spacingTop=10;" vertex="1" parent="1">
          <mxGeometry x="500" y="331" width="250" height="199" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-47" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-46" target="rVFemPRaLwJsk6ttoFU8-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-46" value="&lt;b&gt;Step 5. Filling Index Orders and Minting&lt;/b&gt;&lt;ol&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Index Order Manager gets list of orders carried to next batch from Solver Strategy, and updates bucket for current batch and proceeds with &quot;Batch Processing (part.2)&quot;&lt;/span&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Index Order Manager gets list of filled orders from Solver Strategy, and calls ITP Minting contract to mint index token.&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;spacing=0;size=14;align=left;spacingRight=20;spacingLeft=10;spacingTop=10;" vertex="1" parent="1">
          <mxGeometry x="800" y="230" width="280" height="199" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-49" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="rVFemPRaLwJsk6ttoFU8-48" target="rVFemPRaLwJsk6ttoFU8-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rVFemPRaLwJsk6ttoFU8-48" value="&lt;b&gt;Step 3. Collateral Routing&lt;/b&gt;&lt;ol&gt;&lt;li&gt;Authorised Provider obtains a list of collateral routing requests, adds them and updates its internal state.&lt;/li&gt;&lt;li&gt;AP interacts with Collateral Router contract to obtain next hop for collateral movement.&lt;/li&gt;&lt;li&gt;AP can confirm with destination, e.g. Binance via API that there is sufficient funds for trading&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;b&gt;Note&lt;/b&gt; Index Order Manager contract would take all new orders, and put their collateral amount, sender address, and permit20 into collateral routing requests, so that AP can then pass those via RPC to corresponding smart-contracts (e.g. OTCCustody) in target networks.&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;spacing=0;size=14;align=left;spacingRight=20;spacingLeft=10;spacingTop=10;" vertex="1" parent="1">
          <mxGeometry x="110" y="-560" width="250" height="319" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
